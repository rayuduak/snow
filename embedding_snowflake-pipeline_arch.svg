<svg viewBox="0 0 1400 1000" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="700" y="30" font-size="24" font-weight="bold" text-anchor="middle" fill="#1976d2">
    Financial Files to Embeddings Pipeline Architecture
  </text>
  
  <!-- Layer 1: User Upload -->
  <g id="user-layer">
    <rect x="50" y="60" width="200" height="100" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="8"/>
    <text x="150" y="90" font-size="16" font-weight="bold" text-anchor="middle" fill="#0d47a1">üë§ User/Application</text>
    <text x="150" y="115" font-size="13" text-anchor="middle" fill="#333">Uploads Financial Files</text>
    <text x="150" y="135" font-size="11" text-anchor="middle" fill="#666">PDF, XLSX, CSV, DOCX</text>
  </g>
  
  <!-- Arrow 1 -->
  <path d="M 150 160 L 150 195" stroke="#1976d2" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="160" y="185" font-size="12" fill="#1976d2">Upload</text>
  
  <!-- Layer 2: Cloud Storage -->
  <g id="cloud-storage">
    <!-- Azure Blob -->
    <rect x="30" y="200" width="140" height="120" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="8"/>
    <text x="100" y="225" font-size="14" font-weight="bold" text-anchor="middle" fill="#e65100">‚òÅÔ∏è Azure Blob</text>
    <text x="100" y="245" font-size="11" text-anchor="middle" fill="#666">Container:</text>
    <text x="100" y="262" font-size="10" text-anchor="middle" fill="#333">financial-docs</text>
    <rect x="45" y="275" width="110" height="35" fill="#ffe0b2" stroke="#ff9800" stroke-width="1" rx="4"/>
    <text x="100" y="295" font-size="9" text-anchor="middle" fill="#333">/reports/Q4_2024.pdf</text>
    
    <!-- AWS S3 -->
    <rect x="190" y="200" width="140" height="120" fill="#fff3e0" stroke="#ff9800" stroke-width="2" rx="8"/>
    <text x="260" y="225" font-size="14" font-weight="bold" text-anchor="middle" fill="#e65100">‚òÅÔ∏è AWS S3</text>
    <text x="260" y="245" font-size="11" text-anchor="middle" fill="#666">Bucket:</text>
    <text x="260" y="262" font-size="10" text-anchor="middle" fill="#333">financial-uploads</text>
    <rect x="205" y="275" width="110" height="35" fill="#ffe0b2" stroke="#ff9800" stroke-width="1" rx="4"/>
    <text x="260" y="295" font-size="9" text-anchor="middle" fill="#333">/invoices/inv_2024.xlsx</text>
  </g>
  
  <!-- Arrow 2 -->
  <path d="M 100 320 L 100 365" stroke="#ff9800" stroke-width="3" fill="none" marker-end="url(#arrowhead-orange)"/>
  <path d="M 260 320 L 260 365" stroke="#ff9800" stroke-width="3" fill="none" marker-end="url(#arrowhead-orange)"/>
  <text x="180" y="350" font-size="12" fill="#ff9800" font-weight="bold">Event Trigger</text>
  
  <!-- Layer 3: Event Processing -->
  <g id="event-processing">
    <rect x="30" y="370" width="300" height="100" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="8"/>
    <text x="180" y="395" font-size="14" font-weight="bold" text-anchor="middle" fill="#4a148c">‚ö° Event Processing</text>
    
    <!-- Azure Event Grid -->
    <rect x="45" y="410" width="130" height="45" fill="#e1bee7" stroke="#7b1fa2" stroke-width="1" rx="4"/>
    <text x="110" y="428" font-size="11" text-anchor="middle" fill="#4a148c">Azure Event Grid</text>
    <text x="110" y="443" font-size="9" text-anchor="middle" fill="#666">BlobCreated Event</text>
    
    <!-- AWS EventBridge -->
    <rect x="185" y="410" width="130" height="45" fill="#e1bee7" stroke="#7b1fa2" stroke-width="1" rx="4"/>
    <text x="250" y="428" font-size="11" text-anchor="middle" fill="#4a148c">AWS EventBridge</text>
    <text x="250" y="443" font-size="9" text-anchor="middle" fill="#666">S3 ObjectCreated</text>
  </g>
  
  <!-- Arrow 3 -->
  <path d="M 180 470 L 180 515" stroke="#7b1fa2" stroke-width="3" fill="none" marker-end="url(#arrowhead-purple)"/>
  <text x="190" y="500" font-size="12" fill="#7b1fa2">Trigger</text>
  
  <!-- Layer 4: Snowflake External Stage -->
  <g id="snowflake-stage">
    <rect x="30" y="520" width="300" height="110" fill="#e3f2fd" stroke="#1976d2" stroke-width="3" rx="8"/>
    <text x="180" y="545" font-size="14" font-weight="bold" text-anchor="middle" fill="#0d47a1">‚ùÑÔ∏è Snowflake External Stage</text>
    
    <rect x="45" y="560" width="270" height="55" fill="#bbdefb" stroke="#1976d2" stroke-width="1" rx="4"/>
    <text x="180" y="580" font-size="10" font-family="monospace" text-anchor="middle" fill="#333">CREATE STAGE azure_financial_stage</text>
    <text x="180" y="595" font-size="10" font-family="monospace" text-anchor="middle" fill="#333">URL='azure://account/container'</text>
    <text x="180" y="610" font-size="10" font-family="monospace" text-anchor="middle" fill="#333">STORAGE_INTEGRATION=azure_int;</text>
  </g>
  
  <!-- Arrow 4 -->
  <path d="M 180 630 L 180 675" stroke="#1976d2" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="190" y="660" font-size="12" fill="#1976d2">Snowpipe Auto-Ingest</text>
  
  <!-- Layer 5: Snowflake Processing -->
  <g id="snowflake-processing">
    <rect x="30" y="680" width="300" height="280" fill="#e8f5e9" stroke="#2e7d32" stroke-width="3" rx="8"/>
    <text x="180" y="705" font-size="14" font-weight="bold" text-anchor="middle" fill="#1b5e20">üîß Snowflake Processing Layer</text>
    
    <!-- Step 1: Snowpipe -->
    <rect x="45" y="720" width="270" height="50" fill="#c8e6c9" stroke="#2e7d32" stroke-width="1" rx="4"/>
    <text x="180" y="738" font-size="11" font-weight="bold" text-anchor="middle" fill="#1b5e20">1. Snowpipe Ingestion</text>
    <text x="180" y="755" font-size="9" text-anchor="middle" fill="#333">Files ‚Üí Staging Table (RAW_DOCUMENTS)</text>
    
    <!-- Step 2: File Parsing -->
    <rect x="45" y="780" width="270" height="50" fill="#c8e6c9" stroke="#2e7d32" stroke-width="1" rx="4"/>
    <text x="180" y="798" font-size="11" font-weight="bold" text-anchor="middle" fill="#1b5e20">2. Document Parsing</text>
    <text x="180" y="815" font-size="9" text-anchor="middle" fill="#333">Python UDF/Stored Proc: Extract text chunks</text>
    
    <!-- Step 3: Embeddings -->
    <rect x="45" y="840" width="270" height="50" fill="#c8e6c9" stroke="#2e7d32" stroke-width="1" rx="4"/>
    <text x="180" y="858" font-size="11" font-weight="bold" text-anchor="middle" fill="#1b5e20">3. Generate Embeddings</text>
    <text x="180" y="875" font-size="9" text-anchor="middle" fill="#333">CORTEX.EMBED_TEXT_768() or External API</text>
    
    <!-- Step 4: Insert -->
    <rect x="45" y="900" width="270" height="50" fill="#c8e6c9" stroke="#2e7d32" stroke-width="1" rx="4"/>
    <text x="180" y="918" font-size="11" font-weight="bold" text-anchor="middle" fill="#1b5e20">4. Insert into Hybrid Table</text>
    <text x="180" y="935" font-size="9" text-anchor="middle" fill="#333">Store chunks + embeddings + metadata</text>
  </g>
  
  <!-- Right side: Hybrid Tables & Usage -->
  <g id="hybrid-tables">
    <!-- Arrow to Hybrid Tables -->
    <path d="M 330 820 L 400 820" stroke="#2e7d32" stroke-width="3" fill="none" marker-end="url(#arrowhead-green)"/>
    
    <!-- Hybrid Tables Box -->
    <rect x="400" y="680" width="550" height="280" fill="#fff3e0" stroke="#ff9800" stroke-width="3" rx="8"/>
    <text x="675" y="705" font-size="16" font-weight="bold" text-anchor="middle" fill="#e65100">‚ö° Hybrid Tables Storage</text>
    
    <!-- Table 1: Document Embeddings -->
    <rect x="420" y="720" width="250" height="220" fill="#ffe0b2" stroke="#ff9800" stroke-width="2" rx="6"/>
    <text x="545" y="740" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">HYBRID_DOCUMENT_EMBEDDINGS</text>
    
    <g font-size="9" fill="#333">
      <text x="430" y="760" font-weight="bold">embedding_id (PK)</text>
      <text x="430" y="775">document_id</text>
      <text x="430" y="790">source_file</text>
      <text x="430" y="805">chunk_text (VARCHAR 5000)</text>
      <text x="430" y="820">chunk_index</text>
      <text x="430" y="835">embedding (VECTOR 768)</text>
      <text x="430" y="850">file_type</text>
      <text x="430" y="865">upload_date</text>
      <text x="430" y="880">metadata (VARIANT)</text>
      <text x="430" y="895" font-style="italic">  - department</text>
      <text x="430" y="910" font-style="italic">  - fiscal_period</text>
      <text x="430" y="925" font-style="italic">  - confidentiality_level</text>
    </g>
    
    <!-- Table 2: Document Metadata -->
    <rect x="690" y="720" width="240" height="150" fill="#ffe0b2" stroke="#ff9800" stroke-width="2" rx="6"/>
    <text x="810" y="740" font-size="12" font-weight="bold" text-anchor="middle" fill="#e65100">HYBRID_DOC_METADATA</text>
    
    <g font-size="9" fill="#333">
      <text x="700" y="760" font-weight="bold">document_id (PK)</text>
      <text x="700" y="775">file_name</text>
      <text x="700" y="790">file_size_mb</text>
      <text x="700" y="805">storage_location</text>
      <text x="700" y="820">total_chunks</text>
      <text x="700" y="835">processing_status</text>
      <text x="700" y="850">uploaded_by</text>
      <text x="700" y="865">created_timestamp</text>
    </g>
    
    <!-- Performance indicator -->
    <rect x="690" y="885" width="240" height="45" fill="#c8e6c9" stroke="#2e7d32" stroke-width="2" rx="6"/>
    <text x="810" y="905" font-size="11" font-weight="bold" text-anchor="middle" fill="#1b5e20">‚ö° Query Performance</text>
    <text x="810" y="922" font-size="10" text-anchor="middle" fill="#333">3-10ms lookup time</text>
  </g>
  
  <!-- Bottom: AI Agent Usage -->
  <g id="ai-usage">
    <rect x="1000" y="680" width="350" height="280" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="3" rx="8"/>
    <text x="1175" y="705" font-size="16" font-weight="bold" text-anchor="middle" fill="#4a148c">ü§ñ Agentic AI Usage</text>
    
    <!-- User Query -->
    <rect x="1020" y="720" width="310" height="50" fill="#e1bee7" stroke="#7b1fa2" stroke-width="1" rx="4"/>
    <text x="1175" y="738" font-size="11" font-weight="bold" text-anchor="middle" fill="#4a148c">User Query</text>
    <text x="1175" y="755" font-size="9" text-anchor="middle" fill="#333">"What were Q4 expenses for marketing?"</text>
    
    <!-- Vector Search -->
    <rect x="1020" y="780" width="310" height="70" fill="#e1bee7" stroke="#7b1fa2" stroke-width="1" rx="4"/>
    <text x="1175" y="798" font-size="10" font-weight="bold" text-anchor="middle" fill="#4a148c">Vector Similarity Search</text>
    <text x="1175" y="815" font-size="8" font-family="monospace" text-anchor="middle" fill="#333">SELECT chunk_text, metadata</text>
    <text x="1175" y="828" font-size="8" font-family="monospace" text-anchor="middle" fill="#333">FROM hybrid_document_embeddings</text>
    <text x="1175" y="841" font-size="8" font-family="monospace" text-anchor="middle" fill="#333">ORDER BY vector_distance(...)</text>
    
    <!-- AI Response -->
    <rect x="1020" y="860" width="310" height="90" fill="#e1bee7" stroke="#7b1fa2" stroke-width="1" rx="4"/>
    <text x="1175" y="878" font-size="11" font-weight="bold" text-anchor="middle" fill="#4a148c">Cortex Agent Response</text>
    <text x="1175" y="895" font-size="9" text-anchor="middle" fill="#333">1. Retrieved relevant chunks (&lt;10ms)</text>
    <text x="1175" y="910" font-size="9" text-anchor="middle" fill="#333">2. Context: Q4 financial report</text>
    <text x="1175" y="925" font-size="9" text-anchor="middle" fill="#333">3. Generated answer with LLM</text>
    <text x="1175" y="940" font-size="9" text-anchor="middle" fill="#333">4. Total response time: ~50ms</text>
  </g>
  
  <!-- Arrows from Hybrid Tables to AI -->
  <path d="M 950 820 L 1000 820" stroke="#7b1fa2" stroke-width="3" fill="none" marker-end="url(#arrowhead-purple)"/>
  <text x="965" y="815" font-size="11" fill="#7b1fa2" font-weight="bold">Query</text>
  
  <!-- Legend -->
  <g id="legend">
    <rect x="400" y="50" width="950" height="90" fill="#f5f5f5" stroke="#666" stroke-width="1" rx="6"/>
    <text x="875" y="70" font-size="14" font-weight="bold" text-anchor="middle" fill="#333">Processing Flow</text>
    
    <text x="420" y="95" font-size="11" fill="#333">1. User uploads financial files to Azure Blob/AWS S3</text>
    <text x="420" y="112" font-size="11" fill="#333">2. Cloud events trigger Snowpipe auto-ingestion via External Stage</text>
    <text x="420" y="129" font-size="11" fill="#333">3. Snowflake parses files, generates embeddings, stores in Hybrid Tables (sub-10ms access)</text>
  </g>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#1976d2"/>
    </marker>
    <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#ff9800"/>
    </marker>
    <marker id="arrowhead-purple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#7b1fa2"/>
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#2e7d32"/>
    </marker>
  </defs>
</svg>